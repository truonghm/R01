<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Biến đổi dữ liệu: join | Giới thiệu ngắn gọn về ngôn ngữ R - Phần 1</title>
  <meta name="description" content="5 Biến đổi dữ liệu: join | Giới thiệu ngắn gọn về ngôn ngữ R - Phần 1" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Biến đổi dữ liệu: join | Giới thiệu ngắn gọn về ngôn ngữ R - Phần 1" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="truonghm/R01" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Biến đổi dữ liệu: join | Giới thiệu ngắn gọn về ngôn ngữ R - Phần 1" />
  
  
  

<meta name="author" content="Truong Hoang" />


<meta name="date" content="2019-11-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bin-i-d-liu-basic.html"/>
<link rel="next" href="cu-truc-iu-khin-control-flow.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Mở đầu</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i>Disclaimer</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#outline-draft"><i class="fa fa-check"></i>Outline draft</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#to-do"><i class="fa fa-check"></i>To-do</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#general-resources"><i class="fa fa-check"></i>General resources</a></li>
</ul></li>
<li class="part"><span><b>Giới thiệu chung</b></span></li>
<li class="chapter" data-level="1" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html"><i class="fa fa-check"></i><b>1</b> Làm quen với R</a><ul>
<li class="chapter" data-level="1.1" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#tinh-toan-co-ban-trong-r"><i class="fa fa-check"></i><b>1.1</b> Tính toán cơ bản trong R</a></li>
<li class="chapter" data-level="1.2" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#gan-bin-assignment"><i class="fa fa-check"></i><b>1.2</b> Gán biến (Assignment)</a></li>
<li class="chapter" data-level="1.3" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#vector"><i class="fa fa-check"></i><b>1.3</b> Vector</a></li>
<li class="chapter" data-level="1.4" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#cac-goi-thu-vin-packages"><i class="fa fa-check"></i><b>1.4</b> Các gói thư viện (packages)</a></li>
<li class="chapter" data-level="1.5" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#tim-kim-cau-tra-li"><i class="fa fa-check"></i><b>1.5</b> Tìm kiếm câu trả lời</a><ul>
<li class="chapter" data-level="1.5.1" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#documentation-cua-r"><i class="fa fa-check"></i><b>1.5.1</b> Documentation của R</a></li>
<li class="chapter" data-level="1.5.2" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#stackoverflow"><i class="fa fa-check"></i><b>1.5.2</b> Stackoverflow</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#workflow-co-ban-trong-r"><i class="fa fa-check"></i><b>1.6</b> Workflow cơ bản trong R</a><ul>
<li class="chapter" data-level="1.6.1" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#r-script-file-uoi-.r"><i class="fa fa-check"></i><b>1.6.1</b> R Script (file đuôi *.R)</a></li>
<li class="chapter" data-level="1.6.2" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#r-markdown-file-uoi-.rmd"><i class="fa fa-check"></i><b>1.6.2</b> R Markdown (file đuôi *.Rmd)</a></li>
<li class="chapter" data-level="1.6.3" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#r-project-file-uoi-.rproj"><i class="fa fa-check"></i><b>1.6.3</b> R Project (file đuôi *.Rproj)</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="lam-quen-vi-r.html"><a href="lam-quen-vi-r.html#tham-khao"><i class="fa fa-check"></i><b>1.7</b> Tham khảo</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-frame.html"><a href="data-frame.html"><i class="fa fa-check"></i><b>2</b> Data frame</a><ul>
<li class="chapter" data-level="2.1" data-path="data-frame.html"><a href="data-frame.html#import-d-liu-co-ban"><i class="fa fa-check"></i><b>2.1</b> Import dữ liệu cơ bản</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-frame.html"><a href="data-frame.html#t-package"><i class="fa fa-check"></i><b>2.1.1</b> Từ package</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-frame.html"><a href="data-frame.html#import-t-excel-file-csv-hoc-file-txt"><i class="fa fa-check"></i><b>2.1.2</b> Import từ Excel, file csv hoặc file txt</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-frame.html"><a href="data-frame.html#cac-loai-d-liu-value-type"><i class="fa fa-check"></i><b>2.2</b> Các loại dữ liệu (Value type)</a></li>
<li class="chapter" data-level="2.3" data-path="data-frame.html"><a href="data-frame.html#truy-vn-d-liu-co-ban"><i class="fa fa-check"></i><b>2.3</b> Truy vấn dữ liệu cơ bản</a></li>
<li class="chapter" data-level="2.4" data-path="data-frame.html"><a href="data-frame.html#tham-khao-1"><i class="fa fa-check"></i><b>2.4</b> Tham khảo</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ve-biu-.html"><a href="ve-biu-.html"><i class="fa fa-check"></i><b>3</b> Vẽ biểu đồ</a><ul>
<li class="chapter" data-level="3.1" data-path="ve-biu-.html"><a href="ve-biu-.html#cac-biu--co-ban"><i class="fa fa-check"></i><b>3.1</b> Các biểu đồ cơ bản</a><ul>
<li class="chapter" data-level="3.1.1" data-path="ve-biu-.html"><a href="ve-biu-.html#scatterplot"><i class="fa fa-check"></i><b>3.1.1</b> Scatterplot</a></li>
<li class="chapter" data-level="3.1.2" data-path="ve-biu-.html"><a href="ve-biu-.html#boxplot"><i class="fa fa-check"></i><b>3.1.2</b> Boxplot</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ve-biu-.html"><a href="ve-biu-.html#tieu--va-t-ten-truc"><i class="fa fa-check"></i><b>3.2</b> Tiêu đề và đặt tên trục</a></li>
<li class="chapter" data-level="3.3" data-path="ve-biu-.html"><a href="ve-biu-.html#dan-nhan-d-liu-annotation"><i class="fa fa-check"></i><b>3.3</b> Dán nhãn dữ liệu (annotation)</a></li>
<li class="chapter" data-level="3.4" data-path="ve-biu-.html"><a href="ve-biu-.html#facet"><i class="fa fa-check"></i><b>3.4</b> Facet</a></li>
<li class="chapter" data-level="3.5" data-path="ve-biu-.html"><a href="ve-biu-.html#cac-thut-ng"><i class="fa fa-check"></i><b>3.5</b> Các thuật ngữ</a></li>
<li class="chapter" data-level="3.6" data-path="ve-biu-.html"><a href="ve-biu-.html#tham-khao-2"><i class="fa fa-check"></i><b>3.6</b> Tham khảo</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html"><i class="fa fa-check"></i><b>4</b> Biến đổi dữ liệu: basic</a><ul>
<li class="chapter" data-level="4.1" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#gii-thiu-chung-v-dplyr-va-tibble"><i class="fa fa-check"></i><b>4.1</b> Giới thiệu chung về <strong>dplyr</strong> và <code>tibble</code></a><ul>
<li class="chapter" data-level="4.1.1" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#tibble"><i class="fa fa-check"></i><b>4.1.1</b> Tibble</a></li>
<li class="chapter" data-level="4.1.2" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#package-dplyr"><i class="fa fa-check"></i><b>4.1.2</b> Package <strong>dplyr</strong></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#cac-verb-trong-dplyr"><i class="fa fa-check"></i><b>4.2</b> Các “verb” trong <strong>dplyr</strong></a><ul>
<li class="chapter" data-level="4.2.1" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#add_row"><i class="fa fa-check"></i><b>4.2.1</b> <code>add_row()</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#select-filter-va-slice"><i class="fa fa-check"></i><b>4.2.2</b> <code>select()</code>, <code>filter()</code> và <code>slice()</code></a></li>
<li class="chapter" data-level="4.2.3" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#arrange"><i class="fa fa-check"></i><b>4.2.3</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="4.2.4" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#mutate-transmute"><i class="fa fa-check"></i><b>4.2.4</b> <code>mutate()</code> &amp; <code>transmute()</code></a></li>
<li class="chapter" data-level="4.2.5" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#summarise"><i class="fa fa-check"></i><b>4.2.5</b> <code>summarise()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#kt-hp-cac-ham-trong-dplyr"><i class="fa fa-check"></i><b>4.3</b> Kết hợp các hàm trong <strong>dplyr</strong></a><ul>
<li class="chapter" data-level="4.3.1" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#group_by"><i class="fa fa-check"></i><b>4.3.1</b> <code>group_by()</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#bin-i-d-liu-co-ban"><i class="fa fa-check"></i><b>4.3.2</b> Biến đổi dữ liệu cơ bản</a></li>
<li class="chapter" data-level="4.3.3" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#group_by-va-summarise"><i class="fa fa-check"></i><b>4.3.3</b> <code>group_by</code> và <code>summarise</code></a></li>
<li class="chapter" data-level="4.3.4" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#kt-hp-group_by-va-mutate-filter"><i class="fa fa-check"></i><b>4.3.4</b> Kết hợp <code>group_by</code> và <code>mutate</code> / <code>filter</code></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="bin-i-d-liu-basic.html"><a href="bin-i-d-liu-basic.html#tham-khao-3"><i class="fa fa-check"></i><b>4.4</b> Tham khảo</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html"><i class="fa fa-check"></i><b>5</b> Biến đổi dữ liệu: join</a><ul>
<li class="chapter" data-level="5.1" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html#dataset-czech-financial"><i class="fa fa-check"></i><b>5.1</b> Dataset Czech Financial</a><ul>
<li class="chapter" data-level="5.1.1" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html#y-nghia-cua-cac-data-frames"><i class="fa fa-check"></i><b>5.1.1</b> Ý nghĩa của các data frames</a></li>
<li class="chapter" data-level="5.1.2" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html#din-giai-mi-quan-h"><i class="fa fa-check"></i><b>5.1.2</b> Diễn giải mối quan hệ</a></li>
<li class="chapter" data-level="5.1.3" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html#primary-key-va-foreign-key"><i class="fa fa-check"></i><b>5.1.3</b> Primary key và foreign key</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html#ham-join-trong-dplyr"><i class="fa fa-check"></i><b>5.2</b> Hàm join trong <code>dplyr</code></a><ul>
<li class="chapter" data-level="5.2.1" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html#cach-ham-join-hoat-ng"><i class="fa fa-check"></i><b>5.2.1</b> Cách hàm join hoạt động</a></li>
<li class="chapter" data-level="5.2.2" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html#cac-ham-mutating-join"><i class="fa fa-check"></i><b>5.2.2</b> Các hàm mutating join</a></li>
<li class="chapter" data-level="5.2.3" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html#cac-ham-filtering-joins"><i class="fa fa-check"></i><b>5.2.3</b> Các hàm filtering joins</a></li>
<li class="chapter" data-level="5.2.4" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html#cac-ham-tp-hp"><i class="fa fa-check"></i><b>5.2.4</b> Các hàm tập hợp</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="bin-i-d-liu-join.html"><a href="bin-i-d-liu-join.html#tham-khao-4"><i class="fa fa-check"></i><b>5.3</b> Tham khảo</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html"><i class="fa fa-check"></i><b>6</b> Cấu trúc điều khiển (Control flow)</a><ul>
<li class="chapter" data-level="6.1" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html#biu-thc-phuong-thc-iu-kin-expressions-operators"><i class="fa fa-check"></i><b>6.1</b> Biểu thức &amp; phương thức điều kiện (expressions &amp; operators)</a></li>
<li class="chapter" data-level="6.2" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html#mnh--iu-kin"><i class="fa fa-check"></i><b>6.2</b> Mệnh đề điều kiện</a><ul>
<li class="chapter" data-level="6.2.1" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html#trong-dplyr"><i class="fa fa-check"></i><b>6.2.1</b> Trong <strong>dplyr</strong></a></li>
<li class="chapter" data-level="6.2.2" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html#mnh-if"><i class="fa fa-check"></i><b>6.2.2</b> Mệnh <code>if</code></a></li>
<li class="chapter" data-level="6.2.3" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html#tng-hp-lai"><i class="fa fa-check"></i><b>6.2.3</b> Tổng hợp lại</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html#vong-lp"><i class="fa fa-check"></i><b>6.3</b> Vòng lặp</a><ul>
<li class="chapter" data-level="6.3.1" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html#vong-lp-while"><i class="fa fa-check"></i><b>6.3.1</b> Vòng lặp <code>while</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html#vong-lp-for"><i class="fa fa-check"></i><b>6.3.2</b> Vòng lặp <code>for</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html#chu-y"><i class="fa fa-check"></i><b>6.3.3</b> Chú ý</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="cu-truc-iu-khin-control-flow.html"><a href="cu-truc-iu-khin-control-flow.html#tham-khao-5"><i class="fa fa-check"></i><b>6.4</b> Tham khảo</a></li>
</ul></li>
<li class="part"><span><b>Misc</b></span></li>
<li class="chapter" data-level="7" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html"><i class="fa fa-check"></i><b>7</b> FAQs ngắn gọn về R</a><ul>
<li class="chapter" data-level="7.1" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html#cac-ky-hiu-c-bit-trong-r"><i class="fa fa-check"></i><b>7.1</b> Các ký hiệu đặc biệt trong R</a><ul>
<li class="chapter" data-level="7.1.1" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html#du--"><i class="fa fa-check"></i><b>7.1.1</b> Dấu <code>&lt;-</code></a></li>
<li class="chapter" data-level="7.1.2" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html#du-."><i class="fa fa-check"></i><b>7.1.2</b> Dấu <code>.</code></a></li>
<li class="chapter" data-level="7.1.3" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html#du"><i class="fa fa-check"></i><b>7.1.3</b> Dấu <code>%</code></a></li>
<li class="chapter" data-level="7.1.4" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html#du-va"><i class="fa fa-check"></i><b>7.1.4</b> Dấu <code>:</code> và <code>::</code></a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html#mt-s-cau-hoi-khac"><i class="fa fa-check"></i><b>7.2</b> Một số câu hỏi khác</a><ul>
<li class="chapter" data-level="7.2.1" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html#r-co-th-s-dung-cho-cac-muc-ich-nao-khac-ngoai-scientific-computing-khong"><i class="fa fa-check"></i><b>7.2.1</b> R có thể sử dụng cho các mục đích nào khác ngoài scientific computing không?</a></li>
<li class="chapter" data-level="7.2.2" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html#trong-r-co-tn-tai-h-thngquy-chun-v-style-tuong-uong-pep8-trong-pythong-khong"><i class="fa fa-check"></i><b>7.2.2</b> Trong R có tồn tại hệ thống/quy chuẩn về “style” (tương đương) PEP8 trong Pythong) không?</a></li>
<li class="chapter" data-level="7.2.3" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html#co-nen-s-dung-require--tai-package-khong"><i class="fa fa-check"></i><b>7.2.3</b> Có nên sử dụng <code>require</code> để tải package không?</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="faqs-ngn-gon-v-r.html"><a href="faqs-ngn-gon-v-r.html#tham-khao-6"><i class="fa fa-check"></i><b>7.3</b> Tham khảo</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Giới thiệu ngắn gọn về ngôn ngữ R - Phần 1</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bin-i-d-liu-join" class="section level1">
<h1><span class="header-section-number">5</span> Biến đổi dữ liệu: join</h1>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="bin-i-d-liu-join.html#cb172-1"></a><span class="co"># load sẵn tidyverse</span></span>
<span id="cb172-2"><a href="bin-i-d-liu-join.html#cb172-2"></a><span class="kw">library</span>(tidyverse, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)</span>
<span id="cb172-3"><a href="bin-i-d-liu-join.html#cb172-3"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(datamodelr)) <span class="kw">install.packages</span>(<span class="st">&#39;datamodelr&#39;</span>)</span>
<span id="cb172-4"><a href="bin-i-d-liu-join.html#cb172-4"></a><span class="kw">library</span>(VennDiagram, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)</span>
<span id="cb172-5"><a href="bin-i-d-liu-join.html#cb172-5"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(DiagrammeR)) <span class="kw">install.packages</span>(<span class="st">&#39;DiagrammeR&#39;</span>)</span>
<span id="cb172-6"><a href="bin-i-d-liu-join.html#cb172-6"></a><span class="kw">library</span>(DiagrammeR, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Ở bài trước, chúng ta đã đi qua phần giới thiệu cơ bản về biến đổi dữ liệu trong R thông qua <strong>dplyr</strong>. Tuy nhiên, trong cả bài, chúng ta chỉ mới làm việc với 1 dataset duy nhất, nhưng trong thực tế, ta sẽ cần kết nối thông tin giữa nhiều dataset hay table khác nhau. Ví dụ, trong Excel, ta sẽ dùng các hàm VLOOKUP/HLOOKUP hoặc INDEX/MATCH. Trong SQL, ta sử dụng các hàm JOIN hoặc UNION.</p>
<p><strong>dplyr</strong> cũng cung cấp 1 số function để làm điều này, cụ thể là nhóm các hàm <code>join</code>.</p>
<p>Các dữ liệu dạng bảng có quan hệ với nhau được gọi là <em>relational data</em>.</p>
<div id="dataset-czech-financial" class="section level2">
<h2><span class="header-section-number">5.1</span> Dataset Czech Financial</h2>
<p>Trong phần này, chúng ta sẽ sử dụng (thử) dataset <a href="https://sorry.vse.cz/~berka/challenge/pkdd1999/berka.htm">Czech Bank Financial</a>. Dataset này là tập hợp thông tin giao dịch tài chính từ 1 ngân hàng ở Czech từ năm 1993 đến 1999. Đây là data thật, đã ẩn danh thông tin khách hàng. Có khoảng 5300 khách hàng cùng 4500 tài khoản, sở hữu gần 900 thẻ tín dụng, đã thực hiện hơn 1 triệu giao dịch và có gần 700 khoản vay.</p>
<p><a href="https://github.com/truonghm/R01/tree/master/data/czech_financial_formatted">Dữ liệu</a> sử dụng dưới đây đã được xử lý cơ bản. Mọi người có thể tải dữ liệu gốc <a href="https://github.com/truonghm/R01/tree/master/data/czech_financial_raw">tại đây</a>, và tham khảo code để xử lý dữ liệu <a href="code/czech_financial_cleaning.html">tại đây</a>.</p>
<p>Dữ liệu này rất phù hợp để giới thiệu về relational data trong R, vì bộ dữ liệu gốc đã có sẵn các cột id đóng vai trò là primary key và foreign key.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="bin-i-d-liu-join.html#cb173-1"></a><span class="co"># load data</span></span>
<span id="cb173-2"><a href="bin-i-d-liu-join.html#cb173-2"></a></span>
<span id="cb173-3"><a href="bin-i-d-liu-join.html#cb173-3"></a>file_path &lt;-<span class="st"> &quot;data/czech_financial_formatted/&quot;</span></span>
<span id="cb173-4"><a href="bin-i-d-liu-join.html#cb173-4"></a>file_list &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">path=</span>file_path)</span>
<span id="cb173-5"><a href="bin-i-d-liu-join.html#cb173-5"></a></span>
<span id="cb173-6"><a href="bin-i-d-liu-join.html#cb173-6"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(file_list)) {</span>
<span id="cb173-7"><a href="bin-i-d-liu-join.html#cb173-7"></a>  <span class="kw">assign</span>(<span class="kw">gsub</span>(<span class="st">&quot;.csv&quot;</span>, <span class="st">&quot;&quot;</span>, file_list[i]), </span>
<span id="cb173-8"><a href="bin-i-d-liu-join.html#cb173-8"></a>         <span class="kw">read.csv</span>(<span class="dt">file=</span><span class="kw">paste0</span>(file_path, file_list[i]),</span>
<span id="cb173-9"><a href="bin-i-d-liu-join.html#cb173-9"></a>                  <span class="dt">row.names=</span><span class="dv">1</span>) ) }</span></code></pre></div>
<div id="y-nghia-cua-cac-data-frames" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Ý nghĩa của các data frames</h3>
<p>Dataset <strong>Czech Bank Financial</strong> có 8 table/data frame:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Account</strong> (<code>account_df</code>): là dữ liệu tài khoản ngân hàng</p></li>
<li><p><strong>Client</strong> (<code>client_df</code>): là dữ liệu khách hàng</p></li>
<li><p><strong>Disposition</strong> (<code>disp_df</code>): là dữ liệu về cấp độ quyền vận hành tài khoản của các khách hàng</p></li>
<li><p><strong>Order</strong> (<code>order_df</code>): là dữ liệu về các khoản thanh toán theo kiểu ghi nợ (debit)</p></li>
<li><p><strong>Transactions</strong> (<code>trans_df</code>): là dữ liệu về các khoản giao dịch của tài khoản</p></li>
<li><p><strong>Loans</strong> (<code>loan_df</code>): là dữ liệu khoản vay</p></li>
<li><p><strong>Credit cards</strong> (<code>card_df</code>): là dữ liệu thẻ tín dụng</p></li>
<li><p><strong>District</strong> (<code>district_df</code>): là dữ liệu thống kê nhân khẩu, vùng miền sinh sống của khách hàng</p></li>
</ol>
</div>
<div id="din-giai-mi-quan-h" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Diễn giải mối quan hệ</h3>
<p>Khi làm việc với relational data, chúng ta nên hiểu rõ mối quan hệ giữa các table/data frame bằng cách vẽ ra các diagram. Có nhiều cách để vẽ diagram:</p>
<ul>
<li><p>Đơn giản nhất là có thể lấy giấy bút ra để vẽ.</p></li>
<li><p>Sử dụng 1 số phần mềm như Visio</p></li>
<li><p>Sử dụng 1 số package có sẵn trong R như <strong>datamodelr</strong> (<a href="https://github.com/bergant/datamodelr">github</a>) hoặc <strong>DiagrammeR</strong> (<a href="http://rich-iannone.github.io/DiagrammeR/io.html">website</a>)</p></li>
<li><p>Sử dụng các công cụ chuyên biệt để vẽ <a href="https://en.wikipedia.org/wiki/Entity%E2%80%93relationship_model">ERM</a></p></li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-78"></span>
<img src="images/1-5-czech-financial-diagram.png" alt="Czech Financial Diagram" width="80%" />
<p class="caption">
Figure 5.1: Czech Financial Diagram
</p>
</div>
<p>Diagram ở trên được vẽ bằng <a href="https://dbdiagram.io/d/5dc920beedf08a25543dc311">dbdiagram.io</a>, là một công vụ vẽ entity-relationship diagram sử dụng code khá hiệu quả. Có thể thấy trong biểu đồ, các mối quan hệ được thể hiện theo kiểu:</p>
<ul>
<li>một-một (one-to-one): các đường dẫn sẽ có số <span class="math inline">\(1\)</span> ở hai đầu. Ví dụ: bảng <code>disp_df</code> và <code>client_df</code> có mối quan hệ một-một vì mỗi dòng ở <code>disposition</code> sẽ miêu tả quyền vận hành tài khoản của một client tương ứng. Ngoài ra, dù một account bình thường có thể có nhiều khoản vay, nhưng mối quan hệ giữa <code>account</code> và <code>loan</code> cũng là một-một, tức là trong dataset này một account chỉ có 1 khoản vay:</li>
</ul>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="bin-i-d-liu-join.html#cb174-1"></a>loan_df <span class="op">%&gt;%</span></span>
<span id="cb174-2"><a href="bin-i-d-liu-join.html#cb174-2"></a><span class="st">  </span><span class="kw">count</span>(account_id) <span class="op">%&gt;%</span></span>
<span id="cb174-3"><a href="bin-i-d-liu-join.html#cb174-3"></a><span class="st">  </span><span class="kw">filter</span>(n<span class="op">&gt;</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 0 x 2
## # ... with 2 variables: account_id &lt;int&gt;, n &lt;int&gt;</code></pre>
<ul>
<li><p>một-nhiều (one-to-many): các đường dẫn sẽ có <span class="math inline">\(1\)</span> ở một đầu và dấu <span class="math inline">\(*\)</span> ở đầu còn lại. Ví dụ: giữa <code>client</code> và <code>district</code>, một district có thể có nhiều client, tức là mối quan hệ district-client là một-nhiều.</p></li>
<li><p>nhiều nhiều (many-to-many): không có trong dataset này</p></li>
</ul>
</div>
<div id="primary-key-va-foreign-key" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Primary key và foreign key</h3>
<p>Các variable dùng để kết nối giữa các table với nhau được gọi là “key” (khóa). Đây là các biến giúp chúng ta nhận diện dữ liệu. Đối với các table trong dataset <strong>Czech Bank Financial</strong>, luôn có 1 hoặc nhiều cột <code>*_id</code> đầu tiên đóng vai trò là key. Có 2 loại key trong một bảng:</p>
<ul>
<li><p>Primary key: Khóa chính; giúp nhận diện dữ liệu tại bảng hiện hành:</p>
<ul>
<li>Primary key luôn độc nhất, tức là không có dòng nào lặp lại</li>
<li>Nếu data có sẵn primary key thì đây thường là cột đầu tiên (row names)</li>
<li>Một số dataset có nhiều primary key, tức là có thể phải nối các variable này với nhau để tạo thành key (ví dụ: first name + last name). Tuy nhiên dataset chúng ta đang sử dụng đã có sẵn cột primary key duy nhất ở đầu.</li>
</ul></li>
<li><p>Foreign key: Khóa ngoại; giúp nhận diện dữ liệu tại các bảng khác. Ví dụ: variable <code>district_id</code> trong bảng <code>client_df</code> sẽ giúp nối dữ liệu sang bảng <code>district_df</code>, tức là mỗi client sẽ liên kết được đến với một district.</p>
<ul>
<li>Foreign key có thể lặp lại</li>
<li>Primary key ở 1 bảng có thể đóng vai trò làm foreign key ở bảng khác</li>
</ul></li>
</ul>
<p>Sau khi xác định được các key trong dữ liệu, chúng ta nên kiểm tra lại xem các primary key có thực sự độc nhất (unique) không:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="bin-i-d-liu-join.html#cb176-1"></a>account_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb176-2"><a href="bin-i-d-liu-join.html#cb176-2"></a><span class="st">  </span><span class="kw">count</span>(account_id) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb176-3"><a href="bin-i-d-liu-join.html#cb176-3"></a><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 0 x 2
## # ... with 2 variables: account_id &lt;int&gt;, n &lt;int&gt;</code></pre>
</div>
</div>
<div id="ham-join-trong-dplyr" class="section level2">
<h2><span class="header-section-number">5.2</span> Hàm join trong <code>dplyr</code></h2>
<p>Các hàm <code>join</code> trong <code>dplyr</code> sử dụng được với các kiểu dữ liệu data frame (<code>data.frame</code>) và tibble (<code>tbl_df</code>).</p>
<p>Các kiểu join chính trong <code>dplyr</code> là:</p>
<ul>
<li><p><strong>Mutating joins</strong>: tức là join dữ liệu ở bảng A với bảng B, từ đó bảng A sẽ có thêm các variable mới, gồm các observation khớp với dữ liệu ở bảng B</p></li>
<li><p><strong>Filtering joins</strong>: tức là lọc dữ liệu ở bảng A dựa trên các kết quả khớp với dữ liệu ở bảng B</p></li>
<li><p><strong>Các phép toán tập hợp</strong>: giống như trong toán học, tập hợp dữ liệu có thể áp dụng các phép toán như <code>union</code> hay <code>intersect</code></p></li>
</ul>
<div id="cach-ham-join-hoat-ng" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Cách hàm join hoạt động</h3>
<p>Một hàm join cơ bản có cú pháp <code>join_function(x, y, by = ...</code>, với <code>x</code> và <code>y</code> là 2 data frame. Ví dụ:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="bin-i-d-liu-join.html#cb178-1"></a>account_df <span class="op">%&gt;%</span></span>
<span id="cb178-2"><a href="bin-i-d-liu-join.html#cb178-2"></a><span class="st">  </span><span class="kw">left_join</span>(loan_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;account_id&quot;</span> =<span class="st"> &quot;account_id&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb178-3"><a href="bin-i-d-liu-join.html#cb178-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##   account_id district_id acc_frequency   acc_date loan_id loan_date
## 1        576          55       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 2       3818          74       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 3        704          55       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 4       2378          16       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 5       2632          24       MONTHLY 1993-01-02      NA      &lt;NA&gt;
## 6       1972          77       MONTHLY 1993-01-02      NA      &lt;NA&gt;
##   loan_amount loan_duration loan_payments loan_status
## 1          NA            NA            NA        &lt;NA&gt;
## 2          NA            NA            NA        &lt;NA&gt;
## 3          NA            NA            NA        &lt;NA&gt;
## 4          NA            NA            NA        &lt;NA&gt;
## 5          NA            NA            NA        &lt;NA&gt;
## 6          NA            NA            NA        &lt;NA&gt;</code></pre>
<p>Argument <code>by = c()</code> nhận vector là tên 2 variable để join với nhau ở mỗi bảng. Trong 2 table <code>account_df</code> và <code>loan_df</code>, 2 variable này có cùng tên, vì thế thực chất ta có thể rút gọn lại thành:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="bin-i-d-liu-join.html#cb180-1"></a>account_df <span class="op">%&gt;%</span></span>
<span id="cb180-2"><a href="bin-i-d-liu-join.html#cb180-2"></a><span class="st">  </span><span class="kw">left_join</span>(loan_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;account_id&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb180-3"><a href="bin-i-d-liu-join.html#cb180-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##   account_id district_id acc_frequency   acc_date loan_id loan_date
## 1        576          55       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 2       3818          74       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 3        704          55       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 4       2378          16       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 5       2632          24       MONTHLY 1993-01-02      NA      &lt;NA&gt;
## 6       1972          77       MONTHLY 1993-01-02      NA      &lt;NA&gt;
##   loan_amount loan_duration loan_payments loan_status
## 1          NA            NA            NA        &lt;NA&gt;
## 2          NA            NA            NA        &lt;NA&gt;
## 3          NA            NA            NA        &lt;NA&gt;
## 4          NA            NA            NA        &lt;NA&gt;
## 5          NA            NA            NA        &lt;NA&gt;
## 6          NA            NA            NA        &lt;NA&gt;</code></pre>
<p>Thậm chí, ta có thể viết như sau:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="bin-i-d-liu-join.html#cb182-1"></a>account_df <span class="op">%&gt;%</span></span>
<span id="cb182-2"><a href="bin-i-d-liu-join.html#cb182-2"></a><span class="st">  </span><span class="kw">left_join</span>(loan_df) <span class="op">%&gt;%</span></span>
<span id="cb182-3"><a href="bin-i-d-liu-join.html#cb182-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## Joining, by = &quot;account_id&quot;</code></pre>
<pre><code>##   account_id district_id acc_frequency   acc_date loan_id loan_date
## 1        576          55       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 2       3818          74       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 3        704          55       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 4       2378          16       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 5       2632          24       MONTHLY 1993-01-02      NA      &lt;NA&gt;
## 6       1972          77       MONTHLY 1993-01-02      NA      &lt;NA&gt;
##   loan_amount loan_duration loan_payments loan_status
## 1          NA            NA            NA        &lt;NA&gt;
## 2          NA            NA            NA        &lt;NA&gt;
## 3          NA            NA            NA        &lt;NA&gt;
## 4          NA            NA            NA        &lt;NA&gt;
## 5          NA            NA            NA        &lt;NA&gt;
## 6          NA            NA            NA        &lt;NA&gt;</code></pre>
<p>3 cách viết trên cho kết quả giống như nhau, và cách cuối cùng là cách mặc định, tức là thực tế <code>by = NULL</code>, và <strong>dplyr</strong> sẽ dùng tất cả các variable có xuất hiện ở cả 2 table để join. Khi áp dụng, tốt nhất là nên luôn sử dụng <code>by = c()</code> để cho ra kết quả đúng với mong muốn nhất. Trong 2 table chúng ta đang dùng, chỉ có variable <code>account_id</code> là xuất hiện ở cả 2.</p>
</div>
<div id="cac-ham-mutating-join" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Các hàm mutating join</h3>
<p>Có 4 hàm mutating join sau:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-84"></span>
<img src="images/1-5-join-functions.png" alt="Source: Datacamp" width="80%" />
<p class="caption">
Figure 5.2: Source: Datacamp
</p>
</div>
<p>Các hàm <code>left_join</code>, <code>right_join</code> và <code>full_join</code> được gọi là “outer joins”, nghĩa là khi các observation ở bảng này không match được với bảng kia, các variable mới sẽ nhận giá trị <code>NA</code>.</p>
<p>Trong phần này, chúng ta sẽ sử dụng thêm 1 ví dụ đơn giản để minh họa:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="bin-i-d-liu-join.html#cb185-1"></a>df1 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&#39;meo&#39;</span>, <span class="st">&#39;cho&#39;</span>), <span class="dt">y =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">1</span>)</span>
<span id="cb185-2"><a href="bin-i-d-liu-join.html#cb185-2"></a>df2 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&#39;meo&#39;</span>, <span class="st">&#39;ga&#39;</span>), <span class="dt">a =</span> <span class="dv">7</span>, <span class="dt">b =</span> <span class="st">&quot;a&quot;</span>)</span></code></pre></div>
<div id="inner-join" class="section level4">
<h4><span class="header-section-number">5.2.2.1</span> inner join</h4>
<p>Function <code>inner_join</code> chỉ bao gồm các observation có xuất hiện ở cả 2 data frame:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="bin-i-d-liu-join.html#cb186-1"></a>df1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inner_join</span>(df2, <span class="dt">by =</span> <span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">x</th>
<th align="right">y</th>
<th align="right">a</th>
<th align="left">b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">meo</td>
<td align="right">2</td>
<td align="right">7</td>
<td align="left">a</td>
</tr>
</tbody>
</table>
<p>Có thể thấy observation ‘cho’ ở <code>x</code> không xuất hiện trong kết quả.</p>
<p>Áp dụng với <strong>czech financial</strong>:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="bin-i-d-liu-join.html#cb187-1"></a>account_df <span class="op">%&gt;%</span></span>
<span id="cb187-2"><a href="bin-i-d-liu-join.html#cb187-2"></a><span class="st">  </span><span class="kw">inner_join</span>(loan_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;account_id&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb187-3"><a href="bin-i-d-liu-join.html#cb187-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##   account_id district_id acc_frequency   acc_date loan_id  loan_date
## 1       5270          44       MONTHLY 1993-01-13    6077 1993-11-22
## 2      11265          15       MONTHLY 1993-01-14    7284 1993-09-15
## 3      10364          55       MONTHLY 1993-01-17    7121 1993-11-10
## 4       3834          54       MONTHLY 1993-01-19    5754 1994-09-28
## 5       9307          68       MONTHLY 1993-01-24    6895 1994-09-19
## 6       5891          54       MONTHLY 1993-01-25    6202 1994-04-18
##   loan_amount loan_duration loan_payments loan_status
## 1       79608            24          3317           A
## 2       52788            12          4399           A
## 3       21924            36           609           A
## 4       23052            12          1921           A
## 5       41904            12          3492           A
## 6       65184            12          5432           A</code></pre>
</div>
<div id="left-join" class="section level4">
<h4><span class="header-section-number">5.2.2.2</span> left join</h4>
<p>Function <code>left_join</code> bao gồm tất cả các observation ở <code>x</code> (tức là data frame bên trái), cho dù chúng có khớp với <code>y</code> (data frame bên phải) hay không. Đây cũng là hàm join được sử dụng phổ biến nhất vì hàm này đảm bảo rằng người dùng giữ nguyên các observation của table chính.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="bin-i-d-liu-join.html#cb189-1"></a>df1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(df2, <span class="dt">by =</span> <span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">align=</span><span class="st">&#39;c&#39;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">x</th>
<th align="center">y</th>
<th align="center">a</th>
<th align="center">b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">meo</td>
<td align="center">2</td>
<td align="center">7</td>
<td align="center">a</td>
</tr>
<tr class="even">
<td align="center">cho</td>
<td align="center">1</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
</tbody>
</table>
<p>Các observation ở <code>x</code> không match được với <code>y</code> sẽ nhận giá trị <code>NA</code> tại các variable mới.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="bin-i-d-liu-join.html#cb190-1"></a>account_df <span class="op">%&gt;%</span></span>
<span id="cb190-2"><a href="bin-i-d-liu-join.html#cb190-2"></a><span class="st">  </span><span class="kw">left_join</span>(loan_df) <span class="op">%&gt;%</span></span>
<span id="cb190-3"><a href="bin-i-d-liu-join.html#cb190-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## Joining, by = &quot;account_id&quot;</code></pre>
<pre><code>##   account_id district_id acc_frequency   acc_date loan_id loan_date
## 1        576          55       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 2       3818          74       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 3        704          55       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 4       2378          16       MONTHLY 1993-01-01      NA      &lt;NA&gt;
## 5       2632          24       MONTHLY 1993-01-02      NA      &lt;NA&gt;
## 6       1972          77       MONTHLY 1993-01-02      NA      &lt;NA&gt;
##   loan_amount loan_duration loan_payments loan_status
## 1          NA            NA            NA        &lt;NA&gt;
## 2          NA            NA            NA        &lt;NA&gt;
## 3          NA            NA            NA        &lt;NA&gt;
## 4          NA            NA            NA        &lt;NA&gt;
## 5          NA            NA            NA        &lt;NA&gt;
## 6          NA            NA            NA        &lt;NA&gt;</code></pre>
</div>
<div id="right-join" class="section level4">
<h4><span class="header-section-number">5.2.2.3</span> right join</h4>
<p><code>right_join</code> tương tự với left join, nhưng ngược lại. Function này ưu tiên data frame ở bên phải, khiến vị trí các cột được sắp xếp khác so với kết quả của <code>left_join</code>:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="bin-i-d-liu-join.html#cb193-1"></a>df1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">right_join</span>(df2, <span class="dt">by =</span> <span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">align=</span><span class="st">&#39;c&#39;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">x</th>
<th align="center">y</th>
<th align="center">a</th>
<th align="center">b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">meo</td>
<td align="center">2</td>
<td align="center">7</td>
<td align="center">a</td>
</tr>
<tr class="even">
<td align="center">ga</td>
<td align="center">NA</td>
<td align="center">7</td>
<td align="center">a</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="bin-i-d-liu-join.html#cb194-1"></a>df2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(df1, <span class="dt">by =</span> <span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">align=</span><span class="st">&#39;c&#39;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">x</th>
<th align="center">a</th>
<th align="center">b</th>
<th align="center">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">meo</td>
<td align="center">7</td>
<td align="center">a</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">ga</td>
<td align="center">7</td>
<td align="center">a</td>
<td align="center">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="full-join" class="section level4">
<h4><span class="header-section-number">5.2.2.4</span> full join</h4>
<p><code>full_join</code> bao gồm tất cả các observation ở 2 dataframe.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="bin-i-d-liu-join.html#cb195-1"></a>df1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">full_join</span>(df2) <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">align=</span><span class="st">&#39;c&#39;</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;x&quot;</code></pre>
<table>
<thead>
<tr class="header">
<th align="center">x</th>
<th align="center">y</th>
<th align="center">a</th>
<th align="center">b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">meo</td>
<td align="center">2</td>
<td align="center">7</td>
<td align="center">a</td>
</tr>
<tr class="even">
<td align="center">cho</td>
<td align="center">1</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">ga</td>
<td align="center">NA</td>
<td align="center">7</td>
<td align="center">a</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cac-ham-filtering-joins" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Các hàm filtering joins</h3>
<p>Các hàm filtering joins match dữ liệu giống mutating joins, nhưng chỉ ảnh hưởng đến observation, không ảnh hưởng đến variable (tức là không tạo thêm cột mới).</p>
<p>Có 2 hàm filtering joins:</p>
<ul>
<li><p><code>semi_join (x, y)</code> giữ lại tất cả observation trong <code>x</code> khớp với <code>y</code></p></li>
<li><p><code>anti_join (x, y)</code> bỏ đi tất cả observation trong <code>x</code> khớp với <code>y</code></p></li>
</ul>
<p>Giả sử chúng ta muốn tìm ra tất cả những client có sở hữu credit card:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="bin-i-d-liu-join.html#cb197-1"></a>disp_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb197-2"><a href="bin-i-d-liu-join.html#cb197-2"></a><span class="st">  </span><span class="kw">semi_join</span>(card_df, <span class="dt">by =</span> <span class="st">&quot;disp_id&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb197-3"><a href="bin-i-d-liu-join.html#cb197-3"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## Observations: 892
## Variables: 4
## $ disp_id    &lt;int&gt; 9, 19, 41, 42, 51, 56, 60, 76, 77, 79, 83, 87, 112,...
## $ client_id  &lt;int&gt; 9, 19, 41, 42, 51, 56, 60, 76, 77, 79, 83, 87, 112,...
## $ account_id &lt;int&gt; 7, 14, 33, 34, 43, 48, 51, 65, 66, 68, 71, 73, 95, ...
## $ disp_type  &lt;fct&gt; OWNER, OWNER, OWNER, OWNER, OWNER, OWNER, OWNER, OW...</code></pre>
<p><code>disp_df</code> ban đầu chứa thông tin của 5349 khách hàng, sau đó được lọc ra chỉ còn 892 khách hàng, đúng bằng số observation trong <code>card_df</code>.</p>
<p>Ngược lại, ta có thể lọc ra tất cả client <strong>không</strong> sở hữu credit card:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="bin-i-d-liu-join.html#cb199-1"></a>disp_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb199-2"><a href="bin-i-d-liu-join.html#cb199-2"></a><span class="st">  </span><span class="kw">anti_join</span>(card_df, <span class="dt">by =</span> <span class="st">&quot;disp_id&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb199-3"><a href="bin-i-d-liu-join.html#cb199-3"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## Observations: 4,477
## Variables: 4
## $ disp_id    &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16,...
## $ client_id  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16,...
## $ account_id &lt;int&gt; 1, 2, 2, 3, 3, 4, 5, 6, 8, 8, 9, 10, 11, 12, 12, 13...
## $ disp_type  &lt;fct&gt; OWNER, OWNER, DISPONENT, OWNER, DISPONENT, OWNER, O...</code></pre>
</div>
<div id="cac-ham-tp-hp" class="section level3">
<h3><span class="header-section-number">5.2.4</span> Các hàm tập hợp</h3>
<p>Các hàm tập hợp (set operations) coi observation trong 2 data frame <code>x</code> và <code>y</code> là 2 tập hợp:</p>
<ul>
<li><p><code>intersect(x, y)</code>: trả về observation chỉ xuất hiện trong <code>x</code> và <code>y</code></p></li>
<li><p><code>union(x, y)</code> trả về tất cả observation <em>không lặp lại</em> (unique) trong <code>x</code> và <code>y</code>, tức là nối 2 data frame lại, sau đó bỏ đi observation bị lặp</p></li>
<li><p><code>setdiff(x, y)</code> trả về observation trong <code>x</code>, nhưng không có trong <code>y</code></p></li>
</ul>
<p>Tạo ra 2 data frame giả định sau:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="bin-i-d-liu-join.html#cb201-1"></a>(df1 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">y =</span> <span class="kw">c</span>(1L, 1L)))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##       x     y
##   &lt;int&gt; &lt;int&gt;
## 1     1     1
## 2     2     1</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="bin-i-d-liu-join.html#cb203-1"></a>(df2 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##       x     y
##   &lt;int&gt; &lt;int&gt;
## 1     1     1
## 2     2     2</code></pre>
<p>Có 4 cách áp dụng các set operations:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="bin-i-d-liu-join.html#cb205-1"></a><span class="kw">intersect</span>(df1, df2)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       x     y
##   &lt;int&gt; &lt;int&gt;
## 1     1     1</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="bin-i-d-liu-join.html#cb207-1"></a><span class="co"># Kết quả union trả về có 3 dòng, không phải 4 (bỏ dòng lặp)</span></span>
<span id="cb207-2"><a href="bin-i-d-liu-join.html#cb207-2"></a><span class="kw">union</span>(df1, df2)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##       x     y
##   &lt;int&gt; &lt;int&gt;
## 1     1     1
## 2     2     1
## 3     2     2</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="bin-i-d-liu-join.html#cb209-1"></a><span class="kw">setdiff</span>(df1, df2)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       x     y
##   &lt;int&gt; &lt;int&gt;
## 1     2     1</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="bin-i-d-liu-join.html#cb211-1"></a><span class="kw">setdiff</span>(df2, df1)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       x     y
##   &lt;int&gt; &lt;int&gt;
## 1     2     2</code></pre>
<p>Chúng ta tạo ra 2 data frame giả định <code>loan_1</code> và <code>loan_2</code>, sử dụng <code>loan_df</code>:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="bin-i-d-liu-join.html#cb213-1"></a>loan_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">loan_id =</span> <span class="kw">sample</span>(<span class="kw">min</span>(loan_df<span class="op">$</span>loan_id)<span class="op">:</span><span class="kw">max</span>(loan_df<span class="op">$</span>loan_id),</span>
<span id="cb213-2"><a href="bin-i-d-liu-join.html#cb213-2"></a>                                  <span class="dt">size=</span><span class="dv">200</span>,</span>
<span id="cb213-3"><a href="bin-i-d-liu-join.html#cb213-3"></a>                                  <span class="dt">replace=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb213-4"><a href="bin-i-d-liu-join.html#cb213-4"></a><span class="st">  </span><span class="kw">inner_join</span>(loan_df, <span class="dt">by =</span> <span class="st">&quot;loan_id&quot;</span>)</span>
<span id="cb213-5"><a href="bin-i-d-liu-join.html#cb213-5"></a>loan_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">loan_id =</span> <span class="kw">sample</span>(<span class="kw">min</span>(loan_df<span class="op">$</span>loan_id)<span class="op">:</span><span class="kw">max</span>(loan_df<span class="op">$</span>loan_id),</span>
<span id="cb213-6"><a href="bin-i-d-liu-join.html#cb213-6"></a>                                  <span class="dt">size=</span><span class="dv">300</span>,</span>
<span id="cb213-7"><a href="bin-i-d-liu-join.html#cb213-7"></a>                                  <span class="dt">replace=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb213-8"><a href="bin-i-d-liu-join.html#cb213-8"></a><span class="st">  </span><span class="kw">inner_join</span>(loan_df, <span class="dt">by =</span> <span class="st">&quot;loan_id&quot;</span>)</span>
<span id="cb213-9"><a href="bin-i-d-liu-join.html#cb213-9"></a></span>
<span id="cb213-10"><a href="bin-i-d-liu-join.html#cb213-10"></a><span class="co"># áp dụng intersect</span></span>
<span id="cb213-11"><a href="bin-i-d-liu-join.html#cb213-11"></a><span class="kw">intersect</span>(loan_<span class="dv">1</span>, loan_<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   loan_id account_id loan_date loan_amount loan_duration loan_payments
##     &lt;int&gt;      &lt;int&gt; &lt;fct&gt;           &lt;int&gt;         &lt;int&gt;         &lt;int&gt;
## 1    5229       1329 1997-09-~       23520            12          1960
## 2    5132        817 1995-02-~      538500            60          8975
## 3    6147       5602 1997-12-~      177504            48          3698
## 4    5449       2343 1995-11-~       99336            24          4139
## 5    6737       8564 1995-03-~       76680            24          3195
## 6    7167      10644 1998-06-~      269964            36          7499
## # ... with 1 more variable: loan_status &lt;fct&gt;</code></pre>
</div>
</div>
<div id="tham-khao-4" class="section level2">
<h2><span class="header-section-number">5.3</span> Tham khảo</h2>
<ul>
<li><p><a href="https://r4ds.had.co.nz/relational-data.html">Relational data - R for DS</a></p></li>
<li><p><a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data wrangling cheatsheet</a></p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bin-i-d-liu-basic.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cu-truc-iu-khin-control-flow.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
